{"version":3,"sources":["assets/scripts/Player.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\nimport Maze from \"./Maze\";\nimport {\n\tBRICK_WIDTH,\n\tBRICK_HEIGHT,\n\tMAZE_MOVE_STEP,\n} from \"./helper/GameConstant\";\nconst enum MAZE_DIRECTION {\n\tUP,\n\tDOWN,\n\tLEFT,\n\tRIGHT,\n\tSTILL,\n}\n\n@ccclass\nexport default class Player extends cc.Component {\n\t@property\n\tprivate stepDuration = 0; // 走一步需要用多少时间\n\n\tprivate _isMoving = false;\n\n\tprivate _isPressing = false;\n\n\tprivate _game: Maze = undefined;\n\n\tpublic onLoad(): void {\n\t\tthis._setInputListener();\n\t}\n\n\tpublic init(game: Maze): void {\n\t\tthis._game = game;\n\t}\n\n\tonCollisionEnter(other: cc.Collider, self: cc.Collider): void {\n\t\tconsole.log(\n\t\t\t\"THERE IS A COLLISION : (\" +\n\t\t\t\tother.node.x +\n\t\t\t\t\", \" +\n\t\t\t\tother.node.y +\n\t\t\t\t\") ,  (\" +\n\t\t\t\tself.node.x +\n\t\t\t\t\", \" +\n\t\t\t\tself.node.y +\n\t\t\t\t\")\"\n\t\t);\n\t\tsetTimeout(() => {\n\t\t\tthis._game.levelUp();\n\t\t\tconsole.log(\"LEVEL UP ALREADY\");\n\t\t}, this.stepDuration * 1000); // 必须等接触星星的那次tween执行完了再levelup,否则下一关的position会被overwrite\n\t}\n\n\tprotected onDestroy(): void {\n\t\tthis._closeInputListener();\n\t}\n\n\tprivate _canMove(delX: number, delY: number): boolean {\n\t\treturn !this._game.isWall(\n\t\t\tthis.node.x / BRICK_WIDTH + delX,\n\t\t\tthis.node.y / -BRICK_HEIGHT + delY\n\t\t);\n\t}\n\n\tprivate _setInputListener(): void {\n\t\tcc.systemEvent.on(\n\t\t\tcc.SystemEvent.EventType.KEY_DOWN,\n\t\t\tthis._onKeyDown,\n\t\t\tthis\n\t\t);\n\t\tcc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this._onKeyUp, this);\n\t}\n\n\tprivate _closeInputListener(): void {\n\t\tcc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN);\n\t\tcc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP);\n\t}\n\n\tprivate _onKeyDown(event): void {\n\t\tif (this._isPressing || this._isMoving || !this._game.playerCanMove()) {\n\t\t\treturn;\n\t\t}\n\t\tswitch (event.keyCode) {\n\t\t\tcase cc.macro.KEY.left:\n\t\t\t\tthis._isPressing = true;\n\t\t\t\tthis._moveLeft();\n\t\t\t\tbreak;\n\t\t\tcase cc.macro.KEY.right:\n\t\t\t\tthis._isPressing = true;\n\t\t\t\tthis._moveRight();\n\t\t\t\tbreak;\n\t\t\tcase cc.macro.KEY.up:\n\t\t\t\tthis._isPressing = true;\n\t\t\t\tthis._moveUp();\n\t\t\t\tbreak;\n\t\t\tcase cc.macro.KEY.down:\n\t\t\t\tthis._isPressing = true;\n\t\t\t\tthis._moveDown();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate _moveLeft(): void {\n\t\tif (this._canMove(-1, 0)) {\n\t\t\tthis._startMoving(MAZE_DIRECTION.LEFT);\n\t\t}\n\t}\n\n\tprivate _moveRight(): void {\n\t\tif (this._canMove(1, 0)) {\n\t\t\tthis._startMoving(MAZE_DIRECTION.RIGHT);\n\t\t}\n\t}\n\n\tprivate _moveUp(): void {\n\t\tif (this._canMove(0, -1)) {\n\t\t\tthis._startMoving(MAZE_DIRECTION.UP);\n\t\t}\n\t}\n\n\tprivate _moveDown(): void {\n\t\tif (this._canMove(0, 1)) {\n\t\t\tthis._startMoving(MAZE_DIRECTION.DOWN);\n\t\t}\n\t}\n\n\tprivate _onKeyUp(event): void {\n\t\tswitch (event.keyCode) {\n\t\t\tcase cc.macro.KEY.left:\n\t\t\t\tthis._isPressing = false;\n\t\t\t\tbreak;\n\t\t\tcase cc.macro.KEY.right:\n\t\t\t\tthis._isPressing = false;\n\t\t\t\tbreak;\n\t\t\tcase cc.macro.KEY.up:\n\t\t\t\tthis._isPressing = false;\n\t\t\t\tbreak;\n\t\t\tcase cc.macro.KEY.down:\n\t\t\t\tthis._isPressing = false;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate _startMoving(dir: MAZE_DIRECTION): void {\n\t\tthis._isMoving = true;\n\t\tconst tween = this._getMovement(dir)?.call(() => {\n\t\t\tthis._isMoving = false;\n\t\t});\n\t\tcc.tween(this.node).then(tween).start();\n\t}\n\n\tprivate _getMovement(dir: MAZE_DIRECTION): cc.Tween {\n\t\tswitch (dir) {\n\t\t\tcase MAZE_DIRECTION.DOWN:\n\t\t\t\treturn cc\n\t\t\t\t\t.tween(this.node)\n\t\t\t\t\t.by(\n\t\t\t\t\t\tthis.stepDuration,\n\t\t\t\t\t\t{ y: -MAZE_MOVE_STEP },\n\t\t\t\t\t\t{ easing: \"sineOut\" }\n\t\t\t\t\t);\n\t\t\tcase MAZE_DIRECTION.UP:\n\t\t\t\treturn cc\n\t\t\t\t\t.tween(this.node)\n\t\t\t\t\t.by(\n\t\t\t\t\t\tthis.stepDuration,\n\t\t\t\t\t\t{ y: MAZE_MOVE_STEP },\n\t\t\t\t\t\t{ easing: \"sineOut\" }\n\t\t\t\t\t);\n\t\t\tcase MAZE_DIRECTION.LEFT:\n\t\t\t\treturn cc\n\t\t\t\t\t.tween(this.node)\n\t\t\t\t\t.by(\n\t\t\t\t\t\tthis.stepDuration,\n\t\t\t\t\t\t{ x: -MAZE_MOVE_STEP },\n\t\t\t\t\t\t{ easing: \"sineOut\" }\n\t\t\t\t\t);\n\t\t\tcase MAZE_DIRECTION.RIGHT:\n\t\t\t\treturn cc\n\t\t\t\t\t.tween(this.node)\n\t\t\t\t\t.by(\n\t\t\t\t\t\tthis.stepDuration,\n\t\t\t\t\t\t{ x: MAZE_MOVE_STEP },\n\t\t\t\t\t\t{ easing: \"sineOut\" }\n\t\t\t\t\t);\n\t\t\tdefault:\n\t\t\t\treturn undefined;\n\t\t}\n\t}\n}\n"]}