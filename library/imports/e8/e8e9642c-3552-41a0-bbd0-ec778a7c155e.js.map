{"version":3,"sources":["assets/scripts/Maze.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["/* eslint-disable class-methods-use-this */\nconst { ccclass, property } = cc._decorator;\nimport {\n\tBRICK_HEIGHT,\n\tBRICK_WIDTH,\n\tMAZE_M,\n\tMAZE_N,\n\tTILE_TYPE,\n} from \"./helper/GameConstant\";\nimport MazeBuilder from \"./helper/MazeBuilder\";\n\nimport MazePlayer from \"./Player\";\n\n@ccclass\nexport default class Maze extends cc.Component {\n\t@property(cc.Prefab)\n\tprivate brick: cc.Prefab = undefined;\n\n\t@property(cc.Sprite)\n\tprivate player: cc.Sprite = undefined;\n\n\t@property(cc.Collider)\n\tprivate star: cc.Collider = undefined;\n\n\t@property(cc.Label)\n\tprivate timeDisplay: cc.Label = undefined;\n\n\t@property(cc.ProgressBar)\n\tprivate progressBar: cc.ProgressBar = undefined;\n\n\t@property(cc.Label)\n\tprivate levelLabel: cc.Label = undefined;\n\n\t@property(cc.Label)\n\tprivate gameOverLabel: cc.Label = undefined;\n\n\t@property(cc.Button)\n\tprivate startBtn: cc.Button = undefined;\n\n\t@property(cc.Button)\n\tprivate pauseBtn: cc.Button = undefined;\n\n\t@property\n\tprivate maxMoveTime = 0;\n\n\tprivate _startX = 0;\n\tprivate _startY = 0;\n\tprivate _mazeArray: number[][] = undefined;\n\tprivate _timer = 0;\n\tprivate _isPaused = true;\n\tprivate _level = 0;\n\tprivate _builder: MazeBuilder = undefined;\n\tprivate _brickPool: cc.NodePool = undefined;\n\n\tpublic onLoad(): void {\n\t\t// 开启物理系统\n\t\tcc.director.getCollisionManager().enabled = true;\n\t\t// 初始化砖块对象池\n\t\tthis._brickPool = new cc.NodePool();\n\t\t// cc.director.getCollisionManager().enabledDebugDraw = true;\n\t\t// 生成迷宫数组\n\t\tthis._builder = new MazeBuilder();\n\t\tthis._mazeArray = this._builder.buildMaze();\n\t\tthis._displayMaze();\n\n\t\tthis._startX = BRICK_WIDTH;\n\t\tthis._startY = -BRICK_HEIGHT;\n\n\t\t// 游戏倒计时\n\t\tthis._timer = 0;\n\t\tthis.timeDisplay.string = \"Time: \" + this.maxMoveTime + \"s\";\n\t\tthis.progressBar.progress = 1;\n\t\t// 玩家角色放到固定位置并初始化\n\t\tthis._initPlayer();\n\t}\n\n\tprivate _initPlayer(): void {\n\t\t// 玩家角色放到固定位置并初始化\n\t\tthis.player.node.setPosition(cc.v2(this._startX, this._startY));\n\t\tthis.player.getComponent(MazePlayer).init(this);\n\t}\n\n\tprivate _resetLevel(): void {\n\t\tthis._level = 0;\n\t\tthis.levelLabel.string = \"Level: \" + this._level;\n\t}\n\n\tpublic startPlaying(): void {\n\t\tif (this.gameOverLabel.node.active) {\n\t\t\t// 如果是失败重开, 则重制人物,通关数,时间,迷宫\n\t\t\tthis.gameOverLabel.node.active = false;\n\t\t\t// 通关\n\t\t\tthis._resetLevel();\n\t\t\t// 迷宫\n\t\t\tthis._rebuildMaze();\n\t\t\tthis._displayMaze();\n\t\t}\n\t\t// 重制人物\n\t\tthis.player.node.setPosition(cc.v2(this._startX, this._startY));\n\t\t// 游戏倒计时\n\t\tthis._timer = 0;\n\t\tthis.timeDisplay.string = \"Time: \" + this.maxMoveTime + \"s\";\n\t\tthis.progressBar.progress = 1;\n\t\tthis.startBtn.node.active = false;\n\t\tthis._isPaused = false;\n\t\tthis.pauseBtn.node.active = true;\n\t}\n\n\tpublic onPauseClick(): void {\n\t\tif (this._isPaused) {\n\t\t\tthis._resumeGame();\n\t\t} else {\n\t\t\tthis._pauseGame();\n\t\t}\n\t}\n\n\tprivate _pauseGame(): void {\n\t\tthis._isPaused = true;\n\t\tthis._changeBtnName(\"Resume\");\n\t}\n\n\tprivate _changeBtnName(name: string): void {\n\t\tconst bg = this.pauseBtn.node.getChildByName(\"Background\");\n\t\tconst labelNode = bg.getChildByName(\"Label\");\n\t\tconst labComponent = labelNode.getComponent(cc.Label);\n\t\tlabComponent.string = name;\n\t}\n\n\tprivate _resumeGame(): void {\n\t\tthis._isPaused = false;\n\t\tthis._changeBtnName(\"Pause\");\n\t}\n\n\tprivate _displayMaze(): void {\n\t\tfor (let i = 0; i < MAZE_M; i++) {\n\t\t\tfor (let j = 0; j < MAZE_N; j++) {\n\t\t\t\tswitch (this._mazeArray[i][j]) {\n\t\t\t\t\tcase TILE_TYPE.TILE_WALL:\n\t\t\t\t\t\tthis._forgeBrick(j * BRICK_WIDTH, -i * BRICK_HEIGHT);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase TILE_TYPE.TILE_STAR:\n\t\t\t\t\t\tthis.star.node.setPosition(\n\t\t\t\t\t\t\tj * BRICK_WIDTH,\n\t\t\t\t\t\t\t-i * BRICK_HEIGHT\n\t\t\t\t\t\t);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _forgeBrick(x: number, y: number): void {\n\t\tlet newBrick: cc.Node = undefined;\n\t\tif (this._brickPool.size() > 0) {\n\t\t\tnewBrick = this._brickPool.get();\n\t\t} else {\n\t\t\tnewBrick = cc.instantiate(this.brick);\n\t\t\tnewBrick.width = BRICK_WIDTH;\n\t\t\tnewBrick.height = BRICK_HEIGHT;\n\t\t}\n\t\tthis.node.addChild(newBrick);\n\t\tnewBrick.x = x;\n\t\tnewBrick.y = y;\n\t}\n\n\tprivate _reuseBrick(brick: cc.Node): void {\n\t\tthis._brickPool.put(brick);\n\t}\n\n\tprivate _recycleAllBricks(): void {\n\t\tconst children = this.node.children;\n\t\tfor (let i = children.length - 1; i >= 0; i--) {\n\t\t\tif (children[i].name === \"Brick\") {\n\t\t\t\tthis._reuseBrick(children[i]);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic playerCanMove(): boolean {\n\t\treturn !this._isPaused;\n\t}\n\n\tpublic isWall(x: number, y: number): boolean {\n\t\treturn this._mazeArray[y][x] === TILE_TYPE.TILE_WALL;\n\t}\n\n\tprivate _rebuildMaze(): void {\n\t\tthis._recycleAllBricks();\n\t\tthis._builder.rebuildMaze(this._mazeArray);\n\t}\n\n\tpublic levelUp(): void {\n\t\tthis._timer = 0;\n\t\tthis._level += 1;\n\t\tthis.levelLabel.string = \"Level: \" + this._level;\n\t\tthis._rebuildMaze();\n\t\tthis._displayMaze();\n\t\tthis.player.node.setPosition(cc.v2(this._startX, this._startY));\n\t}\n\n\tprivate _gameOver(): void {\n\t\tthis._isPaused = true;\n\t\tthis.gameOverLabel.node.active = true;\n\t\tthis.startBtn.node.active = true;\n\t}\n\n\tpublic update(dt: number): void {\n\t\tif (this._isPaused) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._timer += dt;\n\t\tif (this._timer >= this.maxMoveTime) {\n\t\t\tthis._gameOver();\n\t\t\treturn;\n\t\t}\n\t\tthis.timeDisplay.string =\n\t\t\t\"Time: \" + Math.floor(this.maxMoveTime - this._timer) + \"s\";\n\t\tthis.progressBar.progress =\n\t\t\tMath.floor(this.maxMoveTime - this._timer) / this.maxMoveTime;\n\t}\n}\n"]}